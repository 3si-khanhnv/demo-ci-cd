<div fxFlex="100%" fxLayout="column" [class.readonly-select]="isReadonly">
  <mat-form-field appearance="outline" *ngIf="!autoComplete" floatLabel="never" [class.has-error]="hasError">
    <!-- <mat-label class="select-placeholder" data-test="show-placeholder" *ngIf="!selectedItem">{{ placeholder | translates }}</mat-label> -->
    <mat-select
      #selector
      fxFlex="100%"
      [aria-label]="label | translates"
      [(value)]="selectedItem"
      (selectionChange)="onSelectionChange($event.value)"
      [disabled]="disabled || isReadonly"
      [panelClass]="[panelClass, panelCustomClass]"
      (click)="stopProp ? $event.stopPropagation() : true"
      [disableOptionCentering]="true"
      [placeholder]="placeholder | translates"
    >
      <mat-select-trigger *ngIf="optionDisplayTemplate">
        {{ selectedItemLabel }}
      </mat-select-trigger>
      <mat-option *ngIf="allowEmpty">{{ emptyLabel | translate }}</mat-option>
      <mat-option *ngFor="let item of items" [value]="item?.value" class="select-option">
        <ng-container
          *ngTemplateOutlet="
            optionDisplayTemplate ? optionDisplayTemplate : defaultOptionDisplay;
            context: { label: optionDisplayTemplate ? item.customLabel : item.label }
          "
        >
        </ng-container>
      </mat-option>
    </mat-select>
  </mat-form-field>

  <mat-form-field
    [class]="isIconTimeSelect ? 'custom-select single-select-search' : 'single-select-search'"
    *ngIf="autoComplete"
    floatLabel="never"
  >
    <input
      class="mat-select-arrow-wrapper"
      type="text"
      [placeholder]="placeholder | translates"
      [attr.aria-label]="placeholder | translates"
      matInput
      #trigger="matAutocompleteTrigger"
      [formControl]="isReadonly ? readonlyFormControl : filterSearchControl"
      [matAutocomplete]="auto"
      [value]="selectedItemLabel"
      (input)="onSearchChange($event.target.value)"
      (keydown.enter)="onSearchKeydown()"
      (focus)="onFocusSearchField()"
      (blur)="onBlurSearchField($event.target.value)"
    />
    <mat-icon (click)="onToggleClick($event)" *ngIf="isIconTimeSelect" matSuffix>alarm</mat-icon>
    <mat-autocomplete [displayWith]="displayWith.bind(this)" #auto="matAutocomplete">
      <mat-option
        *ngIf="allowEmpty"
        [class.mat-selected]="selectedItem === undefined"
        (onSelectionChange)="onSelectionSearchChange($event, undefined)"
      >
        {{ emptyLabel | translate }}
      </mat-option>
      <mat-option
        *ngFor="let item of filteredItems"
        [value]="item.value"
        [class.selected]="item.value === selectedItem"
        [class.mat-selected]="item.value === selectedItem"
        (click)="onClickSearchChange()"
        (onSelectionChange)="onSelectionSearchChange($event, item.value)"
        [ngStyle]="{
          display: item.isHidden ? 'none' : 'flex'
        }"
      >
        <ng-container
          *ngTemplateOutlet="
            optionDisplayTemplate ? optionDisplayTemplate : defaultOptionDisplay;
            context: { label: optionDisplayTemplate ? item.customLabel : item.label }
          "
        >
        </ng-container>
      </mat-option>
    </mat-autocomplete>
  </mat-form-field>
</div>

<ng-template #defaultOptionDisplay let-label="label">{{ label | translate }}</ng-template>
